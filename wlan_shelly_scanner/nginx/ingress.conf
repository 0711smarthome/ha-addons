# /nginx/ingress.conf

server {
  listen 80;
  
  allow 172.30.32.2;
  deny all;
  
  root /var/www;
  index index.html;

  # --- API ROUTING ---
  # Wir verwenden separate, exakte Location-Blöcke für jeden API-Endpunkt.
  # Das ist die empfohlene Methode und ignoriert URL-Parameter wie ?v=... korrekt.

  # Location für den Scan-Trigger
  location = /api/scan {
    proxy_pass http://127.0.0.1:8888;
  }
  
  # Location für den Start der Konfiguration
  location = /api/configure {
    proxy_pass http://127.0.0.1:8889;
  }
  
  # Location für die Fortschritts-Abfrage
  location = /api/progress {
    proxy_pass http://127.0.0.1:8890;
  }
  
  # Fallback für alle anderen Anfragen (z.B. die index.html selbst)
  location / {
    try_files $uri $uri/ /index.html;
  }
}